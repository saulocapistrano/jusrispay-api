<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="011-create-view-vw-loan-with-customer" author="jurispay">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="loan"/>
            <tableExists tableName="customer"/>
        </preConditions>

        <sql>
            <![CDATA[
            create or replace view vw_loan_with_customer as
            select
              l.id as loan_id,
              l.customer_id,
              c.nome_completo as customer_name,
              l.valor_solicitado,
              l.valor_devolucao_prevista,
              l.taxa_juros,
              l.multa_diaria,
              l.data_liberacao,
              l.data_prevista_devolucao,
              l.data_criacao,
              l.data_atualizacao,
              l.status,
              l.periodo_pagamento,
              l.quantidade_parcelas,
              l.valor_parcela
            from loan l
            join customer c on c.id = l.customer_id;
            ]]>
        </sql>
    </changeSet>

</databaseChangeLog>
